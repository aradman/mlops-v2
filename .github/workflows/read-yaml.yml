name: read-yaml

on:
  workflow_call:
    inputs:
      file_name:
        required: true
        type: string

jobs:
  read-yaml:
    runs-on: ubuntu-latest
    outputs:
      location: ${{ steps.read_yaml.outputs.location }}
      namespace: ${{ steps.read_yaml.outputs.namespace }}
      postfix: ${{ steps.read_yaml.outputs.postfix }}
      environment: ${{ steps.read_yaml.outputs.environment }}
      resource_count: ${{ steps.read_yaml.outputs.resource_count }}
      location_abbreviation: ${{ steps.read_yaml.outputs.location_abbreviation }}
      enable_aml_computecluster: ${{ steps.read_yaml.outputs.enable_aml_computecluster }}
      enable_monitoring: ${{ steps.read_yaml.outputs.enable_monitoring }}
      resource_group: ${{ steps.read_yaml.outputs.resource_group }}
      aml_workspace: ${{ steps.read_yaml.outputs.aml_workspace }}
      bep: ${{ steps.read_yaml.outputs.bep }}
      oep: ${{ steps.read_yaml.outputs.oep }}
      terraform_version: ${{ steps.read_yaml.outputs.terraform_version }}
      terraform_workingdir: ${{ steps.read_yaml.outputs.terraform_workingdir }}
      terraform_st_location: ${{ steps.read_yaml.outputs.terraform_st_location }}
      terraform_st_resource_group: ${{ steps.read_yaml.outputs.terraform_st_resource_group }}
      terraform_st_storage_account: ${{ steps.read_yaml.outputs.terraform_st_storage_account }}
      terraform_st_container_name: ${{ steps.read_yaml.outputs.terraform_st_container_name }}
      terraform_st_key: ${{ steps.read_yaml.outputs.terraform_st_key }}
    steps:
      - name: Checking out repo
        uses: actions/checkout@v3
      - name: Read YAML file
        id: read_yaml
        run: |
          echo "LOCATION=$(cat ${{ github.workspace }}/${{ inputs.file_name }} | yq r - location)"
          echo "NAMESPACE=$(cat ${{ github.workspace }}/${{ inputs.file_name }} | yq r - namespace)"
          echo "POSTFIX=$(cat ${{ github.workspace }}/${{ inputs.file_name }} | yq r - postfix)"
          echo "ENVIRONMENT=$(cat ${{ github.workspace }}/${{ inputs.file_name }} | yq r - environment)"
          echo "RESOURCE_COUNT=$(cat ${{ github.workspace }}/${{ inputs.file_name }} | yq r - resource_count)"
          echo "LOCATION_ABBREVIATION=$(cat ${{ github.workspace }}/${{ inputs.file_name }} | yq r - location_abbreviation)"
          echo "ENABLE_AML_COMPUTECLUSTER=$(cat ${{ github.workspace }}/${{ inputs.file_name }} | yq r - enable_aml_computecluster)"
          echo "ENABLE_MONITORING=$(cat ${{ github.workspace }}/${{ inputs.file_name }} | yq r - enable_monitoring)"
          echo "RESOURCE_GROUP=$(cat ${{ github.workspace }}/${{ inputs.file_name }} | yq r - resource_group)"
          echo "AML_WORKSPACE=$(cat ${{ github.workspace }}/${{ inputs.file_name }} | yq r - aml_workspace)"
          echo "BEP=$(cat ${{ github.workspace }}/${{ inputs.file_name }} | yq r - bep)"
          echo "OEP=$(cat ${{ github.workspace }}/${{ inputs.file_name }} | yq r - oep)"
          echo "TERRAFORM_VERSION=$(cat ${{ github.workspace }}/${{ inputs.file_name }} | yq r - terraform_version)"
          echo "TERRAFORM_WORKINGDIR=$(cat ${{ github.workspace }}/${{ inputs.file_name }} | yq r - terraform_workingdir)"
          echo "TERRAFORM_ST_LOCATION=$(cat ${{ github.workspace }}/${{ inputs.file_name }} | yq r - terraform_st_location)"
          echo "TERRAFORM_ST_RESOURCE_GROUP=$(cat ${{ github.workspace }}/${{ inputs.file_name }} | yq r - terraform_st_resource_group)"
          echo "TERRAFORM_ST_STORAGE_ACCOUNT=$(cat ${{ github.workspace }}/${{ inputs.file_name }} | yq r - terraform_st_storage_account)"
          echo "TERRAFORM_ST_CONTAINER_NAME=$(cat ${{ github.workspace }}/${{ inputs.file_name }} | yq r - terraform_st_container_name)"
          echo "TERRAFORM_ST_KEY=$(cat ${{ github.workspace }}/${{ inputs.file_name }} | yq r - terraform_st_key)"
